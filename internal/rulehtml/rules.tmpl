{{ define "content" }}
  {{ range $contentIndex, $content := . }}
  {{ if eq $content.Type "text" }}
    {{ $content.Value }}
  {{ end }}
  {{ if eq $content.Type "reference" }}
    <a href="#rule-{{ElementID $content.Value}}">{{ $content.Value }}</a>
  {{ end }}
  {{ if eq $content.Type "symbol" }}
    <i class="ms {{ ManaClass $content.Value }}"></i>
  {{ end }}
  {{ end }}
{{ end }}

{{ define "example" }}
  <div class="example">
    <span class="example-title">
      Example
    </span>
    <div class="example-body">
      {{ template "content" . }}
    </div>
  </div>
{{ end }}

<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" http-equiv="Content-Security-Policy" content="font-src 'self' data:; img-src 'self' data:; default-src 'self' https://fonts.googleapis.com/ https://fonts.gstatic.com/">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/mana-font@latest/css/mana.css" rel="stylesheet" type="text/css" />
  <style>{{.MainCSS}}</style>
  <script>{{.UFuzzyJS}}</script>
  <script>{{.MenuJS}}</script>
</head>
<body>
  <div>
    <nav id="rules-nav" style="position: fixed; top: 0; left: 0; width: 100%; background-color: #46494C; margin-bottom: 1em; display: flex; flex-direction: row; padding: 1em; height: 1.5em;">
      <span style="flex: 1 1 auto;">mtg-html-rules</span>
      <span id="rules-nav-title" style="flex: 1 1 auto;">
        <button>Rules</button>
        <ul id="sections-menu" style="display: none; background-color: #46494C;">
          {{ range $sectionNum, $sectionRule := .Rules.Sections }}
          <li>
            <div>
            <a sectionNum="{{$sectionNum}}" class="section-link" href="#section-{{$sectionNum}}">{{ $sectionRule.Name }}</a><span sectionNum="{{$sectionNum}}" class="subsections-expand" id="subsections-expand-{{$sectionNum}}"> <button>></button></span>
            <ul id="subsections-menu-{{$sectionNum}}" style="display: none;">
              {{ range $subsectionNum, $subsectionRule := $sectionRule.Subsections }}
              <li>
                <a class="subsection-link" href="#rule-{{$subsectionNum}}">{{$subsectionNum}}: {{ $subsectionRule.Name }}</a>
              </li>
              {{ end }}
            </ul>
            </div>
          </li>
          {{ end }}
        </ul>
      </span>
      <span style="margin-right: 2em;">
        <input type="text" id="search-input" placeholder="Search">
      </span>
    </nav>

    <div id="search-results" style="position: fixed; top: 3em; right: 0; width: 25%; background-color: #46494C; margin-bottom: 1em; display: none; flex-direction: column; padding: 1em;">
    </div>
    
    <h1 style="margin-top: 1em">Magic: The Gathering Rules</h1>
    <h2>Rules</h2>
    {{ range $sectionNum, $sectionRule := .Rules.Sections }}
    <div class="section">
      <h3 id="section-{{$sectionNum}}">{{$sectionNum}}: {{ $sectionRule.Name }}</h3>
      {{ range $subsectionNum, $subsectionRule := $sectionRule.Subsections }}
      <div class="subsection">
        <a href="#rule-{{$subsectionNum}}">
          <h4 id="rule-{{$subsectionNum}}">{{$subsectionNum}}: {{ $subsectionRule.Name }}</h4>
        </a>
        {{ range $ruleNum, $rule := $subsectionRule.Rules }}
        <div class="rule" id="rule-{{$subsectionNum}}_{{$ruleNum}}">
          <a href="#rule-{{$subsectionNum}}_{{$ruleNum}}">
            {{$subsectionNum}}.{{$ruleNum}}:
          </a>
          <p class="content">
          {{ template "content" $rule.Contents }}

          {{ range $exampleIndex, $example := $rule.Examples }}
            {{ template "example" $example }}
          {{ end }}
          </p>

          {{ range $subruleLetter, $subrule := $rule.Subrules }}
          <div class="subrule" id="rule-{{$subsectionNum}}_{{$ruleNum}}{{$subruleLetter}}">
            <a href="#rule-{{$subsectionNum}}_{{$ruleNum}}{{$subruleLetter}}">
              {{$subsectionNum}}.{{$ruleNum}}{{$subruleLetter}}: 
            </a>

            <p class="content">
            {{ template "content" $subrule.Contents }}

            {{ range $exampleIndex, $example := $subrule.Examples }}
              {{ template "example" $example }}
            {{ end }}
            </p>
          </div>
          {{end}}
        </div>
        {{end}}
      </div>
      {{ end }}
    </div>
    {{ end}}
  </div>
  <div>
    <h2>Glossary</h2>
    <ul>
      {{ range $keyword, $definition := .Rules.Glossary }}
      <li>{{$keyword}}: {{$definition}}</li>
      {{ end }}
    </ul>
  </div>
</body>
</html>
